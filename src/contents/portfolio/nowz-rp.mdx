---
title: "NOWZ-RP 학생 관리 프로그램"
description: "나우즈 케어팀의 종합 학생 관리 시스템으로 실시간 채팅, 할 일 관리, 대시보드 등이 핵심 기능"
startDate: "2024-10"
endDate: "2025-08"
tags: ["Next.js 15", "React 19", "TypeScript", "Socket.io"]
category: "portfolio"
featured: true
published: true
---

## 프로그램 개요

나우즈 케어(원격)팀의 **학생 관리 프로그램**

**실시간 채팅**과 **할 일 부여, 확인**이 핵심 기능

---

## 기술 스택

- **프레임워크**: Next 15 (App router) + React 19
- **언어**: TypeScript
- **상태 관리**: zustand
- **스타일링**: tailwind, clsx, shadcn
- **통신**: socket.io
- **폼 유효성 검사**: react-hook-form + zod
- **모니터링/에러**: sentry
- **개발 워크플로우**: husky

---

## 내가 한 역할

### 1. 실시간 채팅

#### 1. 개발 기능

- **카카오톡**과 같은 실시간 채팅 시스템
- 채팅 전송, 검색, 삭제, 답장 및 **양방향 무한 스크롤**, **파일 전송** 기능 포함

#### 2. 개발 기간

- 2024년 8월 1일 ~ 2024년 12월 4일

#### 3. 개발 방법

- **Socket.io**를 활용하여 실시간 채팅 시스템 구축
- **BroadcastChannel API** 활용한 크로스탭 동기화
- **IntersectionObserver API**를 활용하여 양방향 무한 스크롤 구현
- **ChattingRoom** 컴포넌트를 개발하여 학생, 학부모 채팅방에 재사용

#### 4. 해결한 문제

<ProblemBox
  title="문제 1: 채팅 성능 저하"
  situation="초기에는 정해진 양의 채팅만 받아서 렌더링하지만, 실시간으로 채팅이 많이 쌓이거나 이미지 채팅이 많아지는 경우 채팅 기능의 성능 저하가 발생"
  solution="React.memo를 이용하여 메모이제이션하여 INP를 3217ms에서 87ms로 개선"
/>

<ProblemBox
  title="문제 2: 크로스탭 동기화 문제"
  situation="사용자는 학부모와 학생 채팅을 모두 입장 가능한데, 학부모 채팅은 새로운 브라우저로 보여짐. 기존 브라우저의 채팅방 목록에는 학부모 채팅방의 최신 메세지, 읽음 상태 등이 보여지고 있음.
  이 때 학부모 채팅방에서 발생하는 socket 이벤트가 기존 브라우저의 채팅방 목록 socket에 동기화가 되지 않는 문제 발생"
  solution="BroadcastChannel API를 적용하여 문제 해결"
/>

<br />
<ImageContainer
  images={[
    {
      src: "/images/portfolio/nowz-rp/nowz-rp-chat-structure.png",
      alt: "nowz-rp-chat-structure",
      width: "full",
    },
  ]}
/>

### 2. 할 일

#### 1. 개발 기능

- **할 일 추가, 삭제, 수정**
- 날짜, 시간, 내용, 용돈 금액, 인증 방법 등 입력
- **등교, 자기계발, 취침, 기상, 방정리** 등 다양한 카테고리에 맞는 다른 양식의 할 일 모달
- **주소 검색**

#### 2. 개발 기간

- 2025년 3월

#### 3. 개발 방법

**폼 관리**:

- react-hook-form + zod 스키마 검증
- 복잡한 조건부 유효성 검사 구현
- 카테고리별 필수 필드 동적 검증

**모달 구조**:

- ModalForm 컴포넌트 기반
- URL 파라미터 기반 모달 제어

**카테고리 시스템**:

- 2단계 선택 구조 (학습, 생활습관, 자기계발 등)
- 카테고리 변경 시 폼 리셋으로 데이터 무결성 보장

**동적 폼 필드**:

- 조건부 렌더링으로 사용자 경험 최적화
- 카테고리별 맞춤 입력 필드 표시

**날짜 관리**:

- react-day-picker 기반 달력 UI
- "종료일 없음" 체크박스로 nullable 처리

**인증 방법 선택**:

- 위치, 사진, 카메라 인증 방법 선택
- 위치 선택 시 AddAddressModal 연동
- 카카오맵 API로 주소 검색 및 추가

**용돈 입력**:

- 숫자만 입력 가능한 커스텀 입력기
- 천단위 콤마 자동 적용

### 3. 대시보드 개발

1. **개발 기능**
   - **학생 할 일 달성도**, **메모**, **매니저 할 일**, **학생에 대한 개별 회의록** 작성

2. **개발 기간**
   - 2025년 2월

### 4. 등록 관리

#### 1. 개발 기능

- **등록한 학생 및 학부모**를 관리하는 어드민 페이지
- **미등록, 대기, 등록 완료, 만료** 등 상태 변경
- **한 가족에 다른 학생 및 다른 학부모** 연결

#### 2. 개발 기간

- 2025년 4월 ~ 2025년 5월

#### 3. 개발 방법

- 이전에 **ZWON-상담 프로그램**에서 개발한 **Table컴포넌트**와 **Tab컴포넌트**로 개발
- 복잡한 유저 상태와 탭을 컴포넌트 재사용으로 효율적으로 개발

```typescript
export const RegistrationTabContent = ({
  tab,
  familyGroups,
  linkedFamilyGroups,
  unlinkedFamilyGroups,
}: {
  tab: TRegistrationTab
  familyGroups: TFamilyGroupListItem[]
  linkedFamilyGroups: TFamilyGroupListItem[]
  unlinkedFamilyGroups: TFamilyGroupListItem[]
}) => {
  const { renderModal } = useRegistrationModal()

  return (
    <div className='w-full overflow-y-auto max-h-full'>
      {renderModal()}
      {tab === 'unAssigned' && (
        // teamId, familyId가 없는 데이터
        <RegistrationTable
          tab={tab}
          excludeColumns={['checkbox']}
          data={unlinkedFamilyGroups}
        />
      )}
      {tab === 'pending' && (
        <div className='w-full flex flex-col gap-y-4'>
         // teamId가 있고, familyId가 없는 데이터
         // familyId가 있고 status가 pending 데이터
          <RegistrationTable
            title='가족 미연동'
            tab={tab}
            data={unlinkedFamilyGroups}
          />
          <RegistrationTable
            title='가족 연동'
            excludeColumns={['checkbox', 'menu']}
            tab={tab}
            data={linkedFamilyGroups}
          />
        </div>
      )}
      {tab === 'registered' && (
        // 가족 Id가 있고 status가 registered 데이터
        <RegistrationTable
          tab={tab}
          excludeColumns={['checkbox', 'menu']}
          data={familyGroups}
        />
      )}
      {tab === 'expired' && (
        <div className='w-full flex flex-col gap-y-4'>
         // 가족 Id가 있고 status가 expired 데이터
         // teamId가 있고 status가 expired 데이터
         //teamId랑 familyId가 없고 status가 expired 데이터
          <RegistrationTable
            title='가족 미연동'
            tab={tab}
            excludeColumns={['checkbox']}
            data={unlinkedFamilyGroups}
          />
          <RegistrationTable
            title='가족 연동'
            excludeColumns={['checkbox', 'menu']}
            tab={tab}
            data={linkedFamilyGroups}
          />
        </div>
      )}
    </div>
  )
}
```

### 5. Sentry 적용

- **sentry** 적용하여 에러 모니터링 체계 구축

### 6. 성능 개선

<ProblemBox
  title="선제적 보안 위협 대응"
  situation="사용 중인 Next.js 버전에 잠재적 보안 위협을 초래할 수 있는 취약점(CVE-2025-29927)을 확인."
  solution="관련 내용을 즉시 확인하고, 취약점이 해결된 15.2.3 버전으로 신속하게 업데이트하여 보안 위협을 선제적으로 제거."
/>
<ProblemBox
  title="초기 로딩 성능 최적화 (Dynamic Import)"
  situation="채팅 페이지 진입 시, 당장 필요하지 않은 10여 개의 모달 컴포넌트까지 한 번에 불러와 초기 번들 사이즈가 불필요하게 커지는 문제"
  solution="next/dynamic을 활용한 다이나믹 임포트(Dynamic Import)를 적용하여, 모달이 실제 필요한 시점에만 해당 컴포넌트를 불러오도록 개선"
/>
<ProblemBox
  title="Next.js App Router 렌더링 최적화를 통한 서버 부하 개선"
  situation="App Router 환경에서 쿼리스트링으로 UI 상태를 관리하자, 상태가 변경될 때마다 서버 컴포넌트가 재실행되어 불필요한 API 요청이 반복되문 문제 발생.
이로 인해 서버 비용 부담이 증가하고 에러 로깅 분석에 어려움.

서버 컴포넌트에서 **tanstack-query**의 `queryClient.prefetchQuery`로 서버 컴포넌트에서 데이터를 미리 받아서 캐싱하는 전략을 사용하려고 하니, 쿼리스트링이 바뀔 때마다 캐싱이 초기화 되는 문제 발생.

**Next.js**에서는 url을 변경할 때 `Link`나 `router.push`, `router.replace`를 사용하는데, **Page router**에서는 `getServerSideProps`가 다시 호출되지 않고 클라이언트 사이드에서 변경이 이루어지는 반면, **App router**에서는 쿼리스트링을 포함한 url이 변경되면 새로운 요청으로 간주하여 서버 컴포넌트가 서버에서 재실행되고, 그 결과 매번 새로운 **QueryClient** 인스턴스를 생성하여 기존 캐시를 덮어 쓰게 되어서 캐싱이 되지 않음.
"
solution="Next.js 캐싱 설정을 직접 수정하여 불필요한 데이터 재요청을 방지하고, 데이터 수정(PUT, PATCH 등) 후에는 `revalidateTag`로 캐시를 무효화하는 양방향 캐싱 전략을 구현하여 서버 부하를 약 76% 감소."
/>

| 페이지                   | 개선 전 (네트워크 요청 수) | 개선 후 (네트워크 요청 수) | 요청 감소율     |
| :----------------------- | :------------------------- | :------------------------- | :-------------- |
| **채팅**                 | 16개                       | **5개**                    | **약 69%** 감소 |
| **학생관리 - 학생 목록** | 6개                        | **0개**                    | **약 71%** 감소 |
| **학생관리 - 학생 상세** | 9개                        | **0개**                    | **약 71%** 감소 |
| **대시보드**             | 7개                        | **2개**                    | **약 71%** 감소 |
| **등록 관리**            | 4개                        | **0개**                    | **100%** 감소   |
| **평균**                 |                            |                            | **76.4%** 감소  |

\* **채팅 페이지**의 남은 5개 요청은, 실시간 메시지 동기화 등 핵심 기능 유지를 위해 의도적으로 캐싱에서 제외한 필수 요청입니다.

### 7. FileViewerModal 개발

#### 1. 개발 기능

- contentType(image, video)에 따라 사진, 동영상을 보여주는 모달
- 사진 확대, 축소 기능
- 새 창에서 열리는 경우가 있어서 BroadcastChannel API를 이용하여 브라우저간 통신
- 사진이 여러개일 경우 FileNav로 사진 이동 가능
- 전역에서 사용되는 컴포넌트이므로 zustand로 상태 관리

#### 2. 개발 기간

- 2025년 9월

#### 3. 개발 방법

**모달 구조**:

- FileViewerModal 컴포넌트를 중심으로 contentType에 따라 ImageSlider 또는 VideoPlayer 렌더링

**이미지 확대/축소**:

- react-zoom-pan-pinch 라이브러리 활용
- TransformWrapper와 TransformComponent로 이미지 변환 처리
- 마우스 휠, 핀치 제스처, 더블클릭으로 확대/축소 지원
- 최소 0.5배 ~ 최대 5배 확대 가능
- 확대/축소/리셋 버튼 UI 제공

**브라우저간 통신**:

- BroadcastChannel API 구현
- useFileViewerSender: 새 창으로 파일 정보 전송
- useFileViewerSync: 새 창에서 파일 정보 수신 및 동기화
- 학부모 방에서 파일 클릭 시 새 창으로 열리며 실시간 동기화

```typescript
if (newWindow && "addEventListener" in newWindow) {
  newWindow.addEventListener("load", () => {
    requestAnimationFrame(() => {
      safePost(data);
    });
  });
} else if (fallbackImmediate) {
  safePost(data);
}
```

**파일 네비게이션**:

- FileNav 컴포넌트로 다중 파일 관리
- 이전/다음 버튼으로 파일 간 이동
- 현재 인덱스/전체 개수 표시 (예: "3 / 10")
- 복사/다운로드 기능 제공

**상태 관리**:

- useFileViewerModalStore (Zustand)로 전역 상태 관리
- currentIndex, fileIds, contentType, fileLength 상태 관리

### 8. 대시보드 개발

1. **개발 기능**
   - **학생 할 일 달성도**, **메모**, **매니저 할 일**, **학생에 대한 개별 회의록** 작성

2. **개발 기간**
   - 2025년 2월

### 9. 기타 기여사항

- **출시 전 테스트**: QA팀의 부재로 출시 전 테스트 진행
- **출시 전 버그 수정**: **57개** 버그 수정
- **지속적으로 유지 및 보수**, 기능 추가 진행 중
